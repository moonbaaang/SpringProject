<%@page import="java.math.BigDecimal"%>
<%@page import="org.json.JSONArray"%>
<%@page import="org.json.JSONObject"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%-- <%=request.getAttribute("poseResult") %> --%>
<% String image = (String)request.getParameter("image"); %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script src="jquery-3.2.1.min.js"></script>

<script>

/*
1. id="samplecanvas"에 image 변수 저장된 파일 그리기
2. 1번 이미지에서 얼굴 x, y, width, height 값 가져오기
3. 1번 이미지에서 2번 영역 얼굴만 복사하여 id=targetcanvas로 붙여넣기
*/

window.onload = function(){
	var resultdiv = document.getElementById("result")
	var samplecanvas = document.getElementById("samplecanvas");
	var samplecontext = samplecanvas.getContext("2d");
	samplecontext.fillStyle ="red";
	samplecontext.linewidth = 2;
	samplecontext.strokeStyle = "green";
	samplecontext.font = "10px batang"
	
	var image = new Image();
	image.src = "/faceimages/<%=image%>";
	image.onload = function(){
		samplecontext.drawImage(image, 0, 0, image.width, image.height);
	
	<%	 		
		String poseResult = (String)request.getAttribute("poseResult");	
	%>
		var json = JSON.parse('<%=poseResult%>');
		for(var i in json.predictions){
			for(var j in json.predictions[i]){
				var body = json.predictions[i][j] // 18개 객체 "0":{score=xx, x= ,y= }... , "17":{} / [사람][신체부위]
				resultdiv.innerHTML += j + " 신체부위 : x = "+body.x+" y = "+body.y +"<br>";
				samplecontext.fillRect(body.x * image.width, body.y * image.height, 5, 5);
			}			
		}
	
	} // image.onload end
} //window.onload end
</script>
</head>
<body>
<h1> 신체 인식 서비스 </h1>
<div id=result></div>
<h1>이미지 전체 캔버스</h1>
<canvas id="samplecanvas" width=900 height=900 style="border : solid 2px pink"></canvas>
</body>
</html>